import requests
import schedule
import telebot
import random
import time
import os

from dotenv import load_dotenv

load_dotenv()

TG_TOKEN = os.getenv("TG_TOKEN")
CHAT_ID = os.getenv("CHAT_ID")
MESSAGE_THREAD_ID = os.getenv("MESSAGE_THREAD_ID")

bot = telebot.TeleBot(TG_TOKEN)

url = "https://leetcode.com/graphql"

headers = {"Content-Type": "application/json", "Referer": "https://leetcode.com" }

query = """
query getDailyProblem {
    activeDailyCodingChallengeQuestion {
        link
        question {
            title
            difficulty
        }
    }
}
"""

payload = {"query": query}

prephrases = [
    "–ö–æ–¥ –∏–ª–∏ –Ω–µ –∫–æ–¥ ‚Äî –≤–æ—Ç –≤ —á—ë–º –≤–æ–ø—Ä–æ—Å! ü§î\n–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –∑–∞–¥–∞—á–∞: ",
    "–¢—ã–∂ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç? –¢–æ–≥–¥–∞ —Ä–µ—à–∞–π! üßë‚Äçüíª\n–í–æ—Ç –∑–∞–¥–∞—á–∞: ",
    "–ö—Ç–æ, –µ—Å–ª–∏ –Ω–µ —Ç—ã? –ö–æ–≥–¥–∞, –µ—Å–ª–∏ –Ω–µ —Å–µ–π—á–∞—Å? ü§ì\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞: ",
    "–¢–≤–æ—è –º–∞–º–∞ –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∞ —Ç—ã –≤–æ—Ç –¥–æ–ª–∂–µ–Ω! üî•\n–î–µ—Ä–∂–∏ –∑–∞–¥–∞—á—É: ",
    "–í—Å—Ç–∞–≤–∞–π –∏ –∫–æ–¥—å! üò§\n–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –∑–∞–¥–∞—á–∞: ",
    "–°–∏–ª–∞ –≤ —Ç–µ–±–µ –≤–µ–ª–∏–∫–∞, –¥–∂–µ–¥–∞–π –∫–æ–¥–∏–Ω–≥–∞! üåå\n–í–æ—Ç –∑–∞–¥–∞—á–∞: ",
    "–ò–ª–æ–Ω –ú–∞—Å–∫ —É–∂–µ —Ä–µ—à–∏–ª —ç—Ç—É –∑–∞–¥–∞—á—É! üöÄ\n–ê —Ç—ã? –í–æ—Ç –æ–Ω–∞: ",
    "–ö–æ–¥–∏—Ç—å, —É—á–∏—Ç—å—Å—è, –ø–æ–±–µ–∂–¥–∞—Ç—å! ü•á\n–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤—ã–∑–æ–≤: ",
    "–ü—Ä–æ–±–ª–µ–º—ã? –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –≤—ã–∑–æ–≤—ã! üåü\n–õ–æ–≤–∏ –∑–∞–¥–∞—á—É: ",
    "–•–æ—á–µ—à—å –±–∞–≥–æ–≤ –º–µ–Ω—å—à–µ? –†–µ—à–∞–π –∑–∞–¥–∞—á –±–æ–ª—å—à–µ! üêõ\n–í–æ—Ç —Ç–µ–±–µ –∑–∞–¥–∞—á–∞: ",
    "–ë—É! –ò—Å–ø—É–≥–∞–ª—Å—è? –ù–µ –±–æ–π—Å—è, —è –¥—Ä—É–≥, —è —Ç–µ–±—è –Ω–µ –æ–±–∏–∂—É. –ò–¥–∏ —Å—é–¥–∞, –∏–¥–∏ –∫–æ –º–Ω–µ, —Å—è–¥—å —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π, –ø–æ—Å–º–æ—Ç—Ä–∏. –¢—ã –≤–∏–¥–∏—à—å —ç—Ç—É –∑–∞–¥–∞—á—É? –Ø —Ç–æ–∂–µ –µ—ë –≤–∏–∂—É. –î–∞–≤–∞–π —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –Ω–µ—ë –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º—ã –Ω–µ —Ä–µ—à–∏–º –µ—ë. –¢—ã –Ω–µ —Ö–æ—á–µ—à—å? –ü–æ—á–µ–º—É? üëÄ\n–°–º–æ—Ç—Ä–∏ –Ω–∞ –∑–∞–¥–∞—á—É: ",
    "–ì–¥–µ-—Ç–æ –≥—Ä—É—Å—Ç–Ω—ã–π —Ö–æ–º—è–∫ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç, —á—Ç–æ —Ç—ã –µ—â—ë –Ω–µ –Ω–∞—á–∞–ª —Ç–∞–ø–∞—Ç—å! üêπ\n–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –∑–∞–¥–∞—á–∞: ",
    "–Ø –Ω–µ —Å–∫–∞–∂—É –≤–∞–º:'Let me do it for you!' üß†\n–†–µ—à–∞–π—Ç–µ —ç—Ç—É –∑–∞–¥–∞—á—É —Å–∞–º–∏: ",
    "–ï—Å–ª–∏ —Ä–µ—à–∏—à—å —ç—Ç—É –∑–∞–¥–∞—á—É, —Ç–æ –≤—Å–µ –±—É–¥—É—Ç –≥–æ–≤–æ—Ä–∏—Ç—å:'–ö–∞–∫–æ–π –∂–µ –æ–Ω –µ–±...–º–æ–≥—É—á–∏–π!' üê∂\n–°–µ–≥–æ–¥–Ω—è: ",
    "–í 20:31 –ø—Ä–∏... –ó–∞–¥–∞—á—É –¥–Ω—è —Ä–µ—à–∏–ª –∏ –ø—Ä–∏–±—ã–ª! üëØ\n–ò —Ç—ã —Ä–µ—à–∏: ",
    "–°—Ç–æ—è—Ç—å, –ö–æ–≤–±–æ–π! –ê —Ç—ã —Ä–µ—à–∏–ª –∑–∞–¥–∞—á—É? ü§†\n–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –∑–∞–¥–∞—á–∞: ",
    "–ß—Ç–æ–±—ã –∫—Ä–∏—á–∞—Ç—å '–ì–û–û–û–û–õ' –ø–æ—Ç–æ–º, —Ä–µ—à–∏ –∑–∞–¥–∞—á—É —Å–µ–π—á–∞—Å! üêª\n–ó–∞–¥–∞—á–∞: ",
    "–®–æ —Ç—ã –º–∞–ª–µ–Ω–∫–∏–π, –ø—Ä–∏–≤–µ—Ç, —à–æ —Ç—ã –ø–ª–∞—á–µ—à—å –∏–ª–∏ –Ω–µ—Ç? –ß—Ç–æ–±—ã –Ω–µ –ø–ª–∞–∫–∞—Ç—å —Å 0 –≤ –∫–∞—Ä–º–∞–Ω–µ: —Ä–µ—à–∏ –∑–∞–¥–∞—á—É —Å–µ–π—á–∞—Å! üòø\n–õ–æ–≤–∏: ",
    "–ß—Ç–æ –∑–∞ —Ç—è–≥–∏? –¢–∞–∫–∏–µ –±–∞—Ä—Ö–∞—Ç–Ω—ã–µ —Ç—è–≥–∏, —Ä–µ–±—è—Ç–∞. –§—É-—É—Ñ, –∫–µ—Ñ—Ç–µ–º–µ! –ß—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º —â–µ–≥–æ–ª—è—Ç—å –≤ —Ç–∞–∫–∏—Ö –∂–µ –±–∞—Ä—Ö–∞—Ç–Ω—ã—Ö, —Ä–µ—à–∏ –∑–∞–¥–∞—á—É –∏ –≥—É–ª—è–π! üëû\n–ê–£–§: ",
    "–î—Ä–µ–≤–Ω–∏–µ –†—É—Å—ã —Å—Ä–∞–∂–∞–ª–∏—Å—å –ø—Ä–æ—Ç–∏–≤ –Ø—â–µ—Ä–æ–≤, –∞ —Ç—ã –Ω–µ –º–æ–∂–µ—à—å —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É? –°–ª–∞–±–∞–∫! ü¶é\n–î–µ–ª–∞–π-–¥–µ–ª–∞–π: "
]

def sendDailyProblem(cid, mtid):
    response = requests.post(url, json=payload, headers=headers)

    if response.status_code == 200:        
        sonOfJ = response.json()
        question = sonOfJ["data"]["activeDailyCodingChallengeQuestion"]

        link = "https://leetcode.com" + question["link"]
        title = question["question"]["title"]
        difficulty = question["question"]["difficulty"]

        rnum = random.randint(0, 19)

        message = prephrases[rnum] + title + "\n" + "Difficulty: " + difficulty + "\n" + link
        
        bot.send_message(chat_id=cid, message_thread_id=mtid, text=message)
    else:
        message = "Error: response HTTP status is different from 200"
        bot.send_message(chat_id=cid, message_thread_id=mtid, text=message)

def sendWrapper():
    sendDailyProblem(CHAT_ID, MESSAGE_THREAD_ID)

schedule.every().day.at("04:00").do(sendWrapper)
schedule.every().day.at("16:00").do(sendWrapper)

while True:
    schedule.run_pending()
    time.sleep(1)
